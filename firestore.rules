rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Default deny all access to all documents.
    // Specific collection rules below will grant access where needed.
    match /{document=**} {
      allow read, write: if false;
    }

    // Rules for the 'articles' collection
    // Allow anyone to read articles, but no one to write them from the client.
    match /articles/{articleId} {
      allow read: if true;
      allow write: if false;
    }

    // Rules for the 'users' collection
    // Allow users to read and write to their own document.
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Rules for the 'doctors' collection
    // Allowing authenticated users to read doctor profiles.
    // Disallowing direct client-side writes/updates/deletes to doctor data.
    match /doctors/{doctorId} {
      allow read: if request.auth != null; // Only authenticated users can read
      allow create, update, delete: if false; // Deny client-side creation, update, delete
    }

    // Rules for the 'appointments' collection
    match /appointments/{appointmentId} {
      // Allow creating a new appointment if the user is authenticated and the
      // userId in the document matches their own UID.
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;

      // Allow reading an appointment if the user is authenticated and the
      // userId in the document matches their own UID.
      allow read: if request.auth != null && resource.data.userId == request.auth.uid;

      // Disallow updating or deleting appointments directly from the client-side.
      allow update, delete: if false;
    }
  }
}